---
import Layout from "@/layouts/Layout.astro";
import ResumeCard from "@/components/ui/ResumeCard.astro";
import { getCollection } from "astro:content";
import MarkdownIt from "markdown-it";

// Initialize markdown renderer
const md = new MarkdownIt();

// Get all resume entries, sorted by order
const resumeEntries = await getCollection("resume");
const sortedEntries = resumeEntries.sort((a, b) => a.data.order - b.data.order);
---

<Layout title="Resume" description="My work history">
    <div class="mx-auto w-full max-w-4xl mt-5 md:mt-10 space-y-10">
        <div class="space-y-6">
            <h1>Resume</h1>
            {sortedEntries.map((entry, index) => {
                const renderedContent = md.render(entry.body || '');
                return (
                    <ResumeCard
                        position={entry.data.position}
                        company={entry.data.company}
                        companyUrl={entry.data.companyUrl}
                        location={entry.data.location}
                        dates={entry.data.dates}
                        showBorder={index < sortedEntries.length - 1}
                    >
                        <Fragment set:html={renderedContent} />
                    </ResumeCard>
                );
            })}
        </div>
    </div>
</Layout>
