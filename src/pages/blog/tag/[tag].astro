---
import { getCollection } from "astro:content";
import { slugifyStr } from "@/utils/Slugify";

export async function getStaticPaths() {
    const allPosts = await getCollection("blog");
    const allTags = Array.from(
        new Set(allPosts.flatMap((post) => post.data.tags || [])),
    );
    const slugifiedTags = allTags.map((tag) => slugifyStr(tag));
    const uniqueSlugifiedTags = Array.from(new Set(slugifiedTags));

    return uniqueSlugifiedTags.map((tag) => ({
        params: { tag },
    }));
}

const { tag } = Astro.params;
// Redirect /blog/tag/[tag] to /notes/tag/[tag]
return Astro.redirect(`/notes/tag/${tag}`, 301);
---
